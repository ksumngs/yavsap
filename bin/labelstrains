#!/bin/bash
# Using a tab-delimited file mapping accession numbers to virus strains, convert
# a list of fasta files into two multi-sequence fasta files: one with
# identifiers based on the accession number, and the other with identifiers
# based on the strain name
# Usage: labelstrains list.tsv accession.fasta strain.fasta *.fasta

# Parse the positional arguments
GENOMELIST="${1}"
ACCESSIONOUTPUT="${2}"
STRAINOUTPUT="${3}"

# All other arguments are input fasta files
shift; shift; shift;

# Create the merged files
cat "$@" > "$ACCESSIONOUTPUT"
cat "$@" > "$STRAINOUTPUT"

# Perform per-strain substitution
while read -r LINE; do
  echo "$LINE" | while IFS=$'\t' read -r STRAIN ACCESSION; do
    sed -i "s%^>$ACCESSION .*$%>$ACCESSION%" "$ACCESSIONOUTPUT"
    sed -i "s%^>$ACCESSION .*$%>$STRAIN%" "$STRAINOUTPUT"
  done
done < "$GENOMELIST"
